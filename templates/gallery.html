{% extends "base.html" %}
{% block title %}Gallery — Photography Portfolio{% endblock %}

{% block content %}
<section class="page-header py-5 mt-5">
    <div class="container">
        <h1 class="section-title mb-3">Gallery</h1>
        <p class="text-muted">Browse the full collection. Filter by category below.</p>

        <!-- Filter by category -->
        <div class="d-flex flex-wrap gap-2 mb-4">
            <a href="{{ url_for('gallery') }}" class="btn btn-sm {{ 'btn-dark' if not current_category else 'btn-outline-dark' }}">All</a>
            {% for cat in categories %}
            <a href="{{ url_for('gallery', category=cat) }}" class="btn btn-sm {{ 'btn-dark' if current_category == cat else 'btn-outline-dark' }}">{{ cat }}</a>
            {% endfor %}
        </div>

        <div class="row g-4" id="gallery-grid">
            {% for photo in photos %}
            <div class="col-md-6 col-lg-4 col-xl-3">
                <div class="card border-0 shadow-sm h-100 overflow-hidden gallery-item-card">
                    <a href="#" class="gallery-card-link" data-photo-id="{{ photo.photo_id }}" data-bs-toggle="modal" data-bs-target="#photoModal">
                        <div class="gallery-card-img-wrapper position-relative">
                            <img src="{{ url_for('static', filename='uploads/' + photo.image_filename) }}" alt="{{ photo.title }}" class="card-img-top img-fluid lazy-img" loading="lazy" onerror="this.src='https://picsum.photos/800/600?random={{ photo.photo_id }}';">
                            <div class="gallery-card-overlay">
                                <span class="gallery-card-title">{{ photo.title }}</span>
                            </div>
                        </div>
                    </a>
                    <div class="card-body py-2">
                        <h6 class="card-title mb-0">{{ photo.title }}</h6>
                        {% if photo.category %}<span class="badge bg-secondary">{{ photo.category }}</span>{% endif %}
                    </div>
                </div>
            </div>
            {% else %}
            <div class="col-12 text-center text-muted py-5">
                <p>No photos in this category yet.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Modal / lightbox for photo detail -->
<div class="modal fade" id="photoModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title" id="photoModalTitle">—</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img id="photoModalImage" src="" alt="" class="img-fluid rounded">
                <p id="photoModalDescription" class="text-muted mt-2 small"></p>
                <a id="photoModalLink" href="#" class="btn btn-dark btn-sm mt-2">View Full Page</a>
            </div>
        </div>
    </div>
</div>

<script>
(function() {
    var modal = document.getElementById('photoModal');
    if (!modal) return;
    var photoData = {
        {% for photo in photos %}
        {{ photo.photo_id }}: {
            title: {{ photo.title|tojson }},
            description: {{ (photo.description or '')|tojson }},
            imageUrl: "{{ url_for('static', filename='uploads/' + photo.image_filename) }}",
            detailUrl: "{{ url_for('photo_detail', photo_id=photo.photo_id) }}"
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    };
    modal.addEventListener('show.bs.modal', function(e) {
        var btn = e.relatedTarget;
        if (!btn || !btn.classList.contains('gallery-card-link')) return;
        var id = parseInt(btn.getAttribute('data-photo-id'), 10);
        var data = photoData[id];
        if (!data) return;
        document.getElementById('photoModalTitle').textContent = data.title;
        document.getElementById('photoModalDescription').textContent = data.description || '';
        document.getElementById('photoModalImage').src = data.imageUrl;
        document.getElementById('photoModalImage').alt = data.title;
        document.getElementById('photoModalLink').href = data.detailUrl;
    });
})();
</script>
{% endblock %}
